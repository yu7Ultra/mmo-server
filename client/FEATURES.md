# 客户端功能使用指南

> 📚 **注意**: 此文档也可在 [../documents/zh/CLIENT_FEATURES.md](../documents/zh/CLIENT_FEATURES.md) 查看

本文档详细说明了MMO客户端如何使用服务器提供的各项功能。

## 功能清单

### ✅ 已实现的服务器功能

#### 1. 移动系统
- **服务器消息**: `move` - `{ x: number, y: number }`
- **客户端实现**: 
  - 方向键控制 (↑↓←→)
  - 按下移动，松开停止
  - 实时同步位置到服务器

#### 2. 战斗系统
- **服务器消息**: `attack` - `{ targetId: string, skillId?: string }`
- **客户端实现**:
  - 点击其他玩家发起攻击
  - 技能快捷键 1-4 自动选择目标
  - 显示生命值条实时反馈伤害

#### 3. 技能系统
- **服务器支持**: Fireball, Heal, Shield, Dash
- **客户端实现**:
  - 显示所有技能及其状态
  - 快捷键 1-4 快速使用
  - 实时显示冷却时间（每100ms更新）
  - 显示魔法消耗
  - 就绪/冷却状态视觉区分

#### 4. 聊天系统
- **服务器消息**: `chat` - `{ message: string, channel?: string }`
- **客户端实现**:
  - 显示聊天消息历史
  - 输入框发送消息
  - 支持回车键快速发送
  - 自动滚动到最新消息
  - 限制显示最多50条消息

#### 5. 任务系统
- **服务器消息**: `quest` - `{ questId: string, action: 'accept' | 'complete' | 'abandon' }`
- **客户端实现**:
  - 显示所有活跃任务
  - 实时更新任务进度
  - 显示任务奖励
  - 完成状态标记（✓）

#### 6. 成就系统
- **服务器功能**: 9个预设成就
- **客户端实现**:
  - 显示已解锁成就列表
  - 成就名称和描述
  - 特殊颜色高亮

#### 7. 排行榜系统
- **服务器功能**: Top 10玩家排名
- **客户端实现**:
  - 显示排名、名称、等级、积分
  - 自动更新（服务器每5秒更新）
  - 清晰的表格布局

#### 8. 玩家状态
- **服务器同步**: 完整的玩家属性
- **客户端实现**:
  - 等级和经验进度
  - 生命值和魔法值（进度条）
  - 攻击、防御、速度属性
  - 击杀/死亡统计
  - 实时更新所有数值

#### 9. 好友系统
- **服务器消息**: `friend` - `{ targetId: string, action: 'add' | 'remove' }`
- **客户端实现**: 当前版本未实现UI（功能已在服务器端）

## 交互方式

### 键盘控制
- `↑` - 向上移动
- `↓` - 向下移动
- `←` - 向左移动
- `→` - 向右移动
- `1` - 使用技能1 (Fireball)
- `2` - 使用技能2 (Heal)
- `3` - 使用技能3 (Shield)
- `4` - 使用技能4 (Dash)
- `Enter` - 发送聊天消息

### 鼠标控制
- **左键点击玩家** - 攻击该玩家
- **点击聊天发送按钮** - 发送消息

## UI布局

```
┌─────────────────────────────────────┬──────────────────┐
│                                     │ 控制说明         │
│                                     ├──────────────────┤
│                                     │ 玩家状态         │
│        游戏画面 (800x600)            │  - 等级/经验     │
│                                     │  - 生命/魔法     │
│        - 红色圆圈：当前玩家          │  - 属性          │
│        - 绿色圆圈：其他玩家          │  - 统计          │
│        - 显示玩家名称                ├──────────────────┤
│        - 生命条（绿色）              │ 技能 (1-4)       │
│        - 魔法条（蓝色）              │  - 显示冷却      │
│                                     │  - 魔法消耗      │
│                                     ├──────────────────┤
│                                     │ 任务             │
│                                     ├──────────────────┤
│                                     │ 成就             │
│                                     ├──────────────────┤
│                                     │ 排行榜           │
│                                     ├──────────────────┤
│                                     │ 聊天             │
│                                     │  - 消息历史      │
│                                     │  - 输入框        │
└─────────────────────────────────────┴──────────────────┘
```

## 技能使用详解

### 技能1: Fireball (火球术)
- **快捷键**: 1
- **类型**: 攻击技能
- **魔法消耗**: 20
- **冷却时间**: 3秒
- **伤害**: 30
- **使用方法**: 按1自动攻击最近的敌人

### 技能2: Heal (治疗术)
- **快捷键**: 2
- **类型**: 治疗技能
- **魔法消耗**: 30
- **冷却时间**: 5秒
- **治疗量**: 40
- **使用方法**: 按2自我治疗

### 技能3: Shield (护盾)
- **快捷键**: 3
- **类型**: 增益技能
- **魔法消耗**: 25
- **冷却时间**: 10秒
- **效果**: +10防御，持续5秒
- **使用方法**: 按3获得护盾

### 技能4: Dash (冲刺)
- **快捷键**: 4
- **类型**: 增益技能
- **魔法消耗**: 15
- **冷却时间**: 4秒
- **效果**: 2倍速度，持续2秒
- **使用方法**: 按4获得加速

## 性能优化

- 技能冷却UI每100ms更新（平滑显示倒计时）
- 聊天消息限制50条（防止内存泄漏）
- 使用Colyseus状态同步机制（高效网络通信）
- Pixi.js WebGL渲染（高性能图形）

## 未来可扩展功能

虽然服务器已支持，但客户端可以进一步增强：

1. **好友系统UI**
   - 显示好友列表
   - 添加/删除好友按钮
   - 好友在线状态

2. **装备系统显示**
   - 显示当前装备
   - 装备属性加成

3. **技能升级UI**
   - 技能等级显示
   - 升级按钮

4. **地图系统**
   - 小地图
   - 玩家位置标记

5. **特效增强**
   - 技能释放特效
   - 伤害数字飘字
   - 升级特效
   - 战斗音效

## 技术实现要点

### 状态同步
使用Colyseus的状态回调机制：
```typescript
$$(player).listen("health", () => updateHealthBar(visual, player));
```

### 定时更新
技能冷却使用定时器而非状态监听（优化性能）：
```typescript
setInterval(() => updateSkillsUI(player), 100);
```

### 事件处理
所有用户输入通过room.send发送到服务器：
```typescript
room.send('attack', { targetId, skillId });
```

## 调试技巧

1. 打开浏览器控制台查看消息日志
2. 观察网络面板中的WebSocket通信
3. 查看room.state对象了解当前状态
4. 使用Colyseus devtools插件

## 常见问题

**Q: 为什么技能按了没反应？**
A: 检查魔法值是否充足，技能是否在冷却中

**Q: 聊天消息发不出去？**
A: 服务器有速率限制（1消息/秒），等待片刻再试

**Q: 看不到其他玩家？**
A: 确认已连接到服务器，检查控制台是否有错误

**Q: 攻击没效果？**
A: 确保点击的是其他玩家（绿色圆圈），不是自己
